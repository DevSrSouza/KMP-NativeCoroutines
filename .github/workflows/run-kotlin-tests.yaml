name: Run Kotlin tests
on:
  workflow_dispatch:
jobs:
  run-tests:
    strategy:
      fail-fast: false
      matrix:
        os: [ macos-11 ]
        java: [ 11 ]
        module: [ core ]
    runs-on: ${{ matrix.os }}
    steps:
      - uses: actions/checkout@v2
      - uses: gradle/wrapper-validation-action@v1
      - uses: actions/setup-java@v2
        with:
          distribution: zulu
          java-version: ${{ matrix.java }}
      - uses: ./.github/actions/cache-gradle
      - uses: ./.github/actions/cache-konan
      - env:
          GRADLE_MODULE:  ${{ format(':kmp-nativecoroutines-{0}', matrix.module) }}
        run: ./gradlew $GRADLE_MODULE:allTests